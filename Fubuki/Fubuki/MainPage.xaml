<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="Fubuki.MainPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:dtos="clr-namespace:Fubuki.Dtos"
    xmlns:viewmodels="clr-namespace:Fubuki.ViewModels"
    x:DataType="viewmodels:MainPageViewModel">
    <Grid
        Margin="16,0"
        RowDefinitions="*"
        RowSpacing="8">

        <RefreshView
            Grid.Row="2"
            Command="{Binding RefreshServiceCardCollectionCommand}"
            IsRefreshing="{Binding IsCollectionRefreshing}">
            <CollectionView ItemsSource="{Binding ServiceCardCollection}">
                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="dtos:RenderDtos">
                        <Border
                            Padding="8,4"
                            BackgroundColor="{Binding ServiceCardStatusColor}"
                            HeightRequest="120"
                            Stroke="Transparent"
                            StrokeShape="RoundRectangle 8">
                            <Grid RowDefinitions="*,*" RowSpacing="16">
                                <Label
                                    Grid.Row="0"
                                    FontSize="24"
                                    LineBreakMode="TailTruncation"
                                    Text="{Binding Service.Name}"
                                    VerticalOptions="Center" />

                                <HorizontalStackLayout
                                    Grid.Row="2"
                                    Margin="0,0,0,0"
                                    HorizontalOptions="End"
                                    Spacing="8">
                                    <Button
                                        Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:MainPageViewModel}}, x:DataType=viewmodels:MainPageViewModel, Path=StartServiceCommand}"
                                        CommandParameter="{Binding .}"
                                        ImageSource="ic_fluent_play_24_regular.png"
                                        IsEnabled="{Binding IsNotActive}"
                                        Style="{StaticResource ActiveBtn}" />

                                    <Button
                                        Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:MainPageViewModel}}, x:DataType=viewmodels:MainPageViewModel, Path=RestartServiceCommand}"
                                        CommandParameter="{Binding .}"
                                        ImageSource="ic_fluent_arrow_counterclockwise_24_regular.png"
                                        IsEnabled="{Binding IsActive}"
                                        Style="{StaticResource ActiveBtn}" />

                                    <Button
                                        Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:MainPageViewModel}}, x:DataType=viewmodels:MainPageViewModel, Path=StopServiceCommand}"
                                        CommandParameter="{Binding .}"
                                        ImageSource="ic_fluent_stop_24_filled.png"
                                        IsEnabled="{Binding IsActive}"
                                        Style="{StaticResource ActiveBtn}" />
                                </HorizontalStackLayout>
                            </Grid>

                            <Border.GestureRecognizers>
                                <TapGestureRecognizer Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:MainPageViewModel}}, x:DataType=viewmodels:MainPageViewModel, Path=GoToDeploysCommand}" CommandParameter="{Binding Service}" />
                            </Border.GestureRecognizers>
                        </Border>
                    </DataTemplate>
                </CollectionView.ItemTemplate>

                <CollectionView.ItemsLayout>
                    <GridItemsLayout Orientation="Vertical" VerticalItemSpacing="4" />
                </CollectionView.ItemsLayout>
            </CollectionView>
        </RefreshView>
    </Grid>
</ContentPage>
